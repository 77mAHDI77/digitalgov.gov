{{/* Single Tag + article list */}}
{{/* lists out the articles for a given tag */}}

{{- define "content" -}}

<main role="main" id="topic" class="collection">
  <div class="grid-container grid-container-desktop">
    <div class="grid-row grid-gap-4">
      <div class="grid-col-12 display-none tablet:display-block tablet:grid-col-4 tablet-lg:grid-col-3">

        {{ partial "core/top-topics.html" . }}

      </div>


      <div class="grid-col-12 tablet:grid-col-8 tablet-lg:grid-col-9">
        <section class="article-list">
          <header>
            <h1>{{- .Title -}}</h1>
            {{- $allpages := (where .Pages "Section" "posts") -}}
            <p>{{- len $allpages -}} pages</p>
          </header>

          {{/* Key Resources — 
          A list of the most important resources tagged with the same topic */}}

          {{/* Of the pages that have this topic, this returns the pages in the "Resources" section */}}
          {{- $resources := (where .Pages "Section" "resources") -}}

          {{/* If there are any resources at all... */}}
          {{- if $resources -}}
          <section class="resources">
            <h4>Key Resources</h4>
            <ul>
              {{- range $resources -}}
                <li><a href="{{- .Permalink -}}">{{- .Title}}</a></li>
              {{- end -}}
            </ul>
          </section>
          {{- end -}}

          {{/* Blog Posts by Topic —
          List all of the blog posts tagged with this topic */}}
          {{- $pages := (where .Paginator.Pages "Section" "posts") -}}
          {{/* If there are any blog posts at all... */}}
          {{- if $pages -}}
            <h3>News and resources from across our community</h3>
            {{/* Loop through all the pages */}}
            {{- range $pages -}}

              {{/* If the source is identified in the article */}}
              {{- if .Params.source -}}
                {{- $source := $.Site.GetPage "page" (print "source_" .Params.source ) -}}
              {{- end -}}

              {{/* If the type is a SPOT (means it links to another publication) */}}
              {{- if eq .Params.type "spot" -}}
                {{/* Spots — External links */}}

                <article data-edit-this="{{- .File.Path -}}">
                  <p>
                    {{/* Favicon
                    If the there is a custom favicon set in /sources/source_[slug].md, then use that... */}}
                    {{- if .Params.source -}}

                      {{- $source := $.Site.GetPage "page" (print "source_" .Params.source ) -}}
                      {{- if $source.Params.icon -}}
                        <img src="{{- $source.Params.icon -}}" alt="">
                      {{- else -}}
                        <img src="https://www.google.com/s2/favicons?domain={{- .Params.source_url -}}" alt="">
                      {{- end -}}

                    {{/* Otherwise, use the Favicon that Google stores for the site. */}}
                    {{- else -}}
                      <img src="https://www.google.com/s2/favicons?domain={{- .Params.source_url -}}" alt="">
                    {{- end -}}

                    {{- .Params.deck | markdownify -}} <em>(via&nbsp;<a href="{{- .Params.source_url -}}">{{- .Params.source_name -}}</a>)</em> <i class="fas fa-external-link-alt"></i></p>

                  <a href="{{- .Params.source_url -}}" title="{{- .Params.source_name -}}"><span></span></a>
                </article>

              {{/* If the type is a digital.gov Blog Post */}}
              {{- else -}}

                <article data-edit-this="{{- .File.Path -}}">
                  <p><img src="{{- "img/digit-16.png" | absURL -}}" alt=""><a href="{{- .Permalink -}}"><strong>{{- .Title | markdownify -}}</strong></a>{{- if .Params.deck -}} — {{- .Params.deck -}}{{- end -}}&nbsp;<em class="date">({{- .Date.Format "Jan _2, 2006" -}})</em></p>
                  <a href="{{- .Permalink -}}" title="{{- .Title | markdownify -}}"><span></span></a>
                </article>
              {{- end -}}


            {{- end -}}
          {{- end -}}

          {{- partial "core/pagination.html" . -}}
        </section>

      </div>
    </div>
  </div>
</main>

{{- end -}}
