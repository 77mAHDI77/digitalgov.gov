{{- partial "core/set-env.html" . -}}
{{- $list := (where .Site.Pages "Section" "topics") -}}
{{- $length := len $list -}}
{
  "version" : "https://jsonfeed.org/version/1",
  "title" : "Topics | {{- .Site.Title -}}",
  "home_page_url" : "{{- .Site.BaseURL -}}",
  "count" : "{{ $length }}",
  "items" : [
  {{- range $i, $e := $list.ByTitle -}}
    {
      "slug" : "{{ .File.Path | replaceRE "^topics/([^/]+).*" "$1" }}",
      "display_name" : "{{ .Title -}}",
      "summary" : "{{ .Params.summary -}}",
      "weight" : "{{- .Params.weight -}}",
      "branch" : {{ $.Scratch.Get "branch" | jsonify }},
      "filename" : {{ .File.LogicalName | jsonify }},
      "filepath" : {{ .File.Path | jsonify }},
      "filepathURL" : {{ printf "https://github.com/%s/%s/blob/%s/content/%s" $.Site.Params.git_org $.Site.Params.git_repo ($.Scratch.Get "branch") .File.Path | jsonify }},
      "editpathURL" : {{ printf "https://github.com/%s/%s/edit/%s/content/%s" $.Site.Params.git_org $.Site.Params.git_repo ($.Scratch.Get "branch") .File.Path | jsonify }}
    }
    {{- $.Scratch.Add "i" 1 -}}
    {{- $iterator := $.Scratch.Get "i" -}}
    {{- if not (eq $length $iterator) -}}, {{- end -}}
  {{ end }}
  ]
}
