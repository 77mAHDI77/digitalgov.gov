<!-- image -->
{{ $cdnurl := .Site.Params.cdnurl }}
{{ $thisimg := index $.Site.Data.images (.Get 0) }}
{{ $imgBase := $thisimg.uid }}
{{ $imgExt := $thisimg.format }}
{{ $imgBaseCDN := printf "%s/%s" $cdnurl $imgBase }}
{{ $imgWidth := $thisimg.width }}
{{ $imgHeight := $thisimg.height }}

<div>
  {{ with .Get "link"}}<a href="{{ . | absURL }}">{{ end }}
  <img
    src='{{ $imgBaseCDN }}_bu.{{ $imgExt }}'
    {{ if or (.Get "alt") $thisimg.alt }}
    alt='{{ with .Get "alt"}}{{ . }}{{ else }}{{ $thisimg.alt }}{{ end }}'
    {{ end }}
    srcset='
    {{ if gt $imgWidth 200 }}{{ $imgBaseCDN }}_bu.{{ $imgExt }} 48w,
      {{ if gt $imgWidth 400 }}
        {{ if gt $imgWidth 600 }}
          {{ $imgBaseCDN }}_w600.{{ $imgExt }} 600w,
        {{ end }}
        {{ $imgBaseCDN }}_w400.{{ $imgExt }} 400w,
      {{ end }}
      {{ $imgBaseCDN }}_w200.{{ $imgExt }} 200w
    {{ else }}
    {{ $imgBaseCDN }}.{{ $imgExt }} {{ $imgWidth }}w
    {{ end }}
      '
    sizes='(max-width: 600px) 100vw, 600px'/>
  {{ with $thisimg.credit }}
    <p class="wp-caption-text">
      {{ . | markdownify }}
    </p>
  {{ end }}
</div>
<!-- image -->
