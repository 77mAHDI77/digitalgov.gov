{{/* set the href as a variable */}}
{{- $href := "" -}}
{{- if .Params.source_url -}}
  {{- $href = (print .Params.source_url "?dg") -}}
{{- else -}}
  {{- $href = (print .Permalink "?dg") -}}
{{- end -}}

<div class="card card-elsewhere card-linked" data-edit-this="/edit/{{- .Type -}}/?page=https://digital.gov{{- (urls.Parse .Permalink).Path -}}" {{- if .Params.short_url -}}data-short_url="{{- .Params.short_url -}}"{{- end -}}>
  <div>

    {{/* Logos
    Get the "source" in the file and looks up the icon that is used there.
    See services/card-service.html for the logo template
    */}}
    
    {{- $source := $.Site.GetPage "page" (print "source_" .Params.source ) -}}
    {{- if $source -}}

      {{- $src := (printf "/logos/%s%s" $source.Params.logo "-logo.png") -}}
      {{- template "logo" dict "src" $src "alt" $source.Params.name "href" $href -}}

    {{- else if .Params.logo -}}

      {{- $src := (printf "/logos/%s%s" .Params.logo "-logo.png") -}}
      {{- template "logo" dict "src" $src "alt" .Params.name "href" $href -}}

    {{- else -}}

      {{- template "logo" dict "src" "/logos/digit-gold.png" "alt" .Params.source "href" $href -}}

    {{- end -}}

    <div class="summary">
      <p>
        {{- if .Params.deck -}}{{- .Params.deck | markdownify | emojify -}}{{- end -}}
        {{- if $source -}}
          {{ $url := urls.Parse .Params.source_url }}
          <em class="source">â€” via <a href="{{- $source.Params.domain -}}" title="Read at {{ $source.Params.name -}}">{{- $source.Params.name -}}</a></em>
        {{ end }}
      </p>
      {{- if $source -}}
        {{ $url := urls.Parse .Params.source_url }}
        <p class="domain"></p>
      {{ end }}

    </div>

  </div>
  <div class="meta">
    <p class="date">{{ dateFormat "Jan 02, 2006" .Date }}</p>
    {{- partial "core/get_clicks" . -}}
  </div>
  <a class="overlay" href="{{- if .Params.short_url -}}{{- .Params.short_url -}}{{- else -}}{{- .Params.source_url -}}{{- end -}}" title="{{- .Params.source_name -}}"><span></span></a>
</div>
